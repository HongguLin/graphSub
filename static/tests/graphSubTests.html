<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Custom D3 Tests</title>
  <link rel="stylesheet" href="https://code.jquery.com/qunit/qunit-1.18.0.css">
</head>
<body>
  <div id="qunit"></div>
  <div id="qunit-fixture"></div>
  <script src="https://code.jquery.com/qunit/qunit-1.18.0.js"></script>
  <script src="../js/graphSub.js" charset="utf-8"></script>
  <script>
    QUnit.module("Unit tests", {
      setup: function() {
      // vars to be used by all tests
      this.testNodes = [
      {"name":"a"},
      {"name":"b"},
      {"name":"c"},
      {"name":"d"},
      {"name":"e"},
      {"name":"f"},
      {"name":"g"},
      {"name":"h"},
      {"name":"i"},
      {"name":"j"},
      {"name":"k"},
      {"name":"l"},
      {"name":"m"},
      {"name":"n"}
      ];

      this.testLinks = [
      {"source":0,"target":1,"value":1},
      {"source":2,"target":3,"value":1},
      {"source":4,"target":5,"value":1},
      {"source":7,"target":8,"value":1},
      {"source":9,"target":10,"value":1},
      {"source":11,"target":12,"value":1},
      {"source":0,"target":5,"value":1},
      {"source":1,"target":5,"value":1},
      {"source":0,"target":6,"value":1},
      {"source":1,"target":6,"value":1},
      {"source":0,"target":7,"value":1},
      {"source":1,"target":7,"value":1},
      {"source":2,"target":8,"value":1},
      {"source":3,"target":8,"value":1},
      {"source":2,"target":9,"value":1},
      {"source":3,"target":9,"value":1},
      {"source":4,"target":11,"value":1},
      {"source":5,"target":11,"value":1},
      {"source":9,"target":12,"value":1},
      {"source":10,"target":12,"value":1},
      {"source":11,"target":13,"value":1},
      {"source":12,"target":13,"value":1}
      ];      
    }
  });

    QUnit.test( "Unit testing of custom D3 code", function( assert ) {
    
    // test buildLinks()
    assert.equal(JSON.stringify(buildLinks(this.testNodes)), 
      JSON.stringify(this.testLinks), 
      "Should parse an array of node objects into a link array for D3");

    // test linkExists()
    var links = [];
    assert.equal(linkExists({"source":5,"target":0}, this.testLinks), 
      true, 
      "Should return true if given link already exists");

    // test linkExists()
    var links = [];
    assert.equal(linkExists({"source":0,"target":5}, this.testLinks), 
      true, 
      "Should return true if given link already exists in opposite direction");

    // test linkExists()
    assert.equal(linkExists({"source":5,"target":18}, this.testLinks),
      false, 
      "Should return false if given link doesn't exist");

    // test findNodeIndexById
    assert.equal(findNodeIndexById('h', this.testNodes),
      7, 
      "Should return the correct node index given its id");
   
    // findNodeById(id, nodes)
    assert.equal(JSON.stringify(findNodeById('e', this.testNodes)),
      JSON.stringify({id: 'e', spouse:['f'], mother: '', father: ''}), 
      "Should return node e given its id");

    // test areSiblings()
    assert.equal(areSiblings(findNodeById('f', this.testNodes),findNodeById('g', this.testNodes)),
      1, 
      "Should deduce that nodes f & g are siblings");

     //test areSiblings()
    assert.equal(areSiblings(findNodeById('e', this.testNodes),findNodeById('k', this.testNodes)), -1, "Should deduce that nodes e & k are not siblings");
    
    // test makeLinkFromNodeIds(sourceId, targetId, nodes)
    assert.equal((makeLinkFromNodeIds('a', 'b', this.testNodes)).toString(), {"source": 0, "target": 1}.toString(), 
      "Should create a valid link object");

    // test addLinkFromIds(sourceId, targetId, nodes, links)
    assert.ok(addLinkFromIds('a','n', this.testNodes, this.testLinks), 'Should add a unique link without error');

    // test addLinkFromIds(sourceId, targetId, nodes, links)
    assert.ok(!addLinkFromIds('a','n', this.testNodes, this.testLinks), 'Should not add a unique link which is already present');

    // test getParents(node, nodes)
    assert.equal(getParents({id: 'a', spouse:['b'], mother: '', father: ''}, this.testNodes).toString(), [].toString(), 'Should return parents of node a');
    
    var result = [].concat(this.testNodes[0], this.testNodes[1]).toString()
    assert.equal(getParents({id: 'f', spouse:['e'], mother: 'a', father: 'b'}, 
      this.testNodes).toString(), 
      result, 
      'Should return parents of node f');

    var result = [this.testNodes[1]]
    // test getSpouses(node, nodes)
    assert.equal(getSpouses(this.testNodes[0], this.testNodes), result, 'Should return the spouse of a');

    // test getSpouses(node, nodes)
    //assert.equal(getSpouses('n', this.testNodes), [], 'Should return the spouse of n');

    // test getSiblings(node, nodes)
    //assert.equal(getSiblings(node, this.testNodes), expected, message);

    // test getChildren(node, nodes)
    //assert.equal(getChildren(node, this.testNodes), expected, message);

    // test buildNSubNetOnId(id, #ofNodes, nodes)
    //assert.ok(buildNSubNetOnId('a', 6, this.testNodes), 'Should extract a subset of n nodes around the id given');

    });
  </script>
</body>
</html>